<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>我的购物车-品优购</title>
  <meta name="description"
    content="品优购JD.COM-专业的综合网上购物商城,销售家电、数码通讯、电脑、家居百货、服装服饰、母婴、图书、食品等数万个品牌优质商品.便捷、诚信的服务，为您提供愉悦的网上购物体验!" />
  <meta name="Keywords" content="网上购物,网上商城,手机,笔记本,电脑,MP3,CD,VCD,DV,相机,数码,配件,手表,存储卡,品优购" />
  <!-- 引入facicon.ico网页图标 -->
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
  <!-- 引入css 初始化的css 文件 -->
  <link rel="stylesheet" href="css/base.css">
  <!-- 引入公共样式的css 文件 -->
  <link rel="stylesheet" href="css/common.css">
  <!-- 引入car css -->
  <link rel="stylesheet" href="css/car.css">
</head>

<body>
  <!-- <input type="text" id="ipt"> -->
  <!-- 顶部快捷导航start -->
  <div class="shortcut">
    <div class="w">
      <div class="fl">
        <ul>
          <li>品优购欢迎您！ </li>
          <li>
            <a href="#">请登录</a>
            <a href="#" class="style-red">免费注册</a>
          </li>
        </ul>
      </div>
      <div class="fr">
        <ul>
          <li><a href="#">我的订单</a></li>
          <li class="spacer"></li>
          <li>
            <a href="#">我的品优购</a>
            <i class="icomoon"></i>
          </li>
          <li class="spacer"></li>
          <li><a href="#">品优购会员</a></li>
          <li class="spacer"></li>
          <li><a href="#">企业采购</a></li>
          <li class="spacer"></li>
          <li><a href="#">关注品优购</a> <i class="icomoon"></i></li>
          <li class="spacer"></li>
          <li><a href="#">客户服务</a> <i class="icomoon"></i></li>
          <li class="spacer"></li>
          <li><a href="#">网站导航</a> <i class="icomoon"></i></li>
        </ul>
      </div>
    </div>
  </div>
  <!-- 顶部快捷导航end  -->


  <div class="car-header">
    <div class="w">
      <div class="car-logo">
        <img src="img/logo.png" alt=""> <b>购物车</b>
      </div>
    </div>
  </div>

  <div class="c-container">
    <div class="w">
      <div class="cart-filter-bar">
        <em>全部商品</em>
      </div>
      <!-- 购物车主要核心区域 -->
      <div class="cart-warp">
        <!-- 头部全选模块 -->
        <div class="cart-thead">
          <div class="t-checkbox">
            <input type="checkbox" name="" id="" class="checkall"> 全选
          </div>
          <div class="t-goods">商品</div>
          <div class="t-price">单价</div>
          <div class="t-num">数量</div>
          <div class="t-sum">小计</div>
          <div class="t-action">操作</div>
        </div>

        <!-- 商品详细模块 -->
        <div class="cart-item-list"></div>

        <!-- 结算模块 -->
        <div class="cart-floatbar">
          <div class="select-all">
            <input type="checkbox" name="" id="" class="checkall">全选
          </div>
          <div class="operation">
            <a href="javascript:;" class="remove-batch"> 删除选中的商品</a>
            <a href="javascript:;" class="clear-all">清理购物车</a>
          </div>
          <div class="toolbar-right">
            <div class="amount-sum">已经选<em>1</em>件商品</div>
            <div class="price-sum">总价： <em>￥12.60</em></div>
            <div class="btn-area">去结算</div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- footer start -->
  <div class="footer">
    <div class="w">
      <!-- mod_service -->
      <div class="mod_service">
        <ul>
          <li>
            <i class="mod-service-icon mod_service_zheng"></i>
            <div class="mod_service_tit">
              <h5>正品保障</h5>
              <p>正品保障，提供发票</p>
            </div>
          </li>
          <li>
            <i class="mod-service-icon mod_service_kuai"></i>
            <div class="mod_service_tit">
              <h5>正品保障</h5>
              <p>正品保障，提供发票</p>
            </div>
          </li>
          <li>
            <i class="mod-service-icon mod_service_bao"></i>
            <div class="mod_service_tit">
              <h5>正品保障</h5>
              <p>正品保障，提供发票</p>
            </div>
          </li>
          <li>
            <i class="mod-service-icon mod_service_bao"></i>
            <div class="mod_service_tit">
              <h5>正品保障</h5>
              <p>正品保障，提供发票</p>
            </div>
          </li>
          <li>
            <i class="mod-service-icon mod_service_bao"></i>
            <div class="mod_service_tit">
              <h5>正品保障</h5>
              <p>正品保障，提供发票</p>
            </div>
          </li>
        </ul>
      </div>
      <!-- mod_help -->
      <div class="mod_help">
        <dl class="mod_help_item">
          <dt>购物指南</dt>
          <dd> <a href="#">购物流程 </a></dd>
          <dd> <a href="#">会员介绍 </a></dd>
          <dd> <a href="#">生活旅行/团购 </a></dd>
          <dd> <a href="#">常见问题 </a></dd>
          <dd> <a href="#">大家电 </a></dd>
          <dd> <a href="#">联系客服 </a></dd>
        </dl>
        <dl class="mod_help_item">
          <dt>购物指南</dt>
          <dd> <a href="#">购物流程 </a></dd>
          <dd> <a href="#">会员介绍 </a></dd>
          <dd> <a href="#">生活旅行/团购 </a></dd>
          <dd> <a href="#">常见问题 </a></dd>
          <dd> <a href="#">大家电 </a></dd>
          <dd> <a href="#">联系客服 </a></dd>
        </dl>
        <dl class="mod_help_item">
          <dt>购物指南</dt>
          <dd> <a href="#">购物流程 </a></dd>
          <dd> <a href="#">会员介绍 </a></dd>
          <dd> <a href="#">生活旅行/团购 </a></dd>
          <dd> <a href="#">常见问题 </a></dd>
          <dd> <a href="#">大家电 </a></dd>
          <dd> <a href="#">联系客服 </a></dd>
        </dl>
        <dl class="mod_help_item">
          <dt>购物指南</dt>
          <dd> <a href="#">购物流程 </a></dd>
          <dd> <a href="#">会员介绍 </a></dd>
          <dd> <a href="#">生活旅行/团购 </a></dd>
          <dd> <a href="#">常见问题 </a></dd>
          <dd> <a href="#">大家电 </a></dd>
          <dd> <a href="#">联系客服 </a></dd>
        </dl>
        <dl class="mod_help_item">
          <dt>购物指南</dt>
          <dd> <a href="#">购物流程 </a></dd>
          <dd> <a href="#">会员介绍 </a></dd>
          <dd> <a href="#">生活旅行/团购 </a></dd>
          <dd> <a href="#">常见问题 </a></dd>
          <dd> <a href="#">大家电 </a></dd>
          <dd> <a href="#">联系客服 </a></dd>
        </dl>
        <dl class="mod_help_item mod_help_app">
          <dt>帮助中心</dt>
          <dd>
            <img src="upload/erweima.png" alt="">
            <p>品优购客户端</p>
          </dd>
        </dl>
      </div>

      <!-- mod_copyright  -->
      <div class="mod_copyright">
        <p class="mod_copyright_links">
          关于我们 | 联系我们 | 联系客服 | 商家入驻 | 营销中心 | 手机品优购 | 友情链接 | 销售联盟 | 品优购社区 | 品优购公益 | English Site | Contact U
        </p>
        <p class="mod_copyright_info">
          地址：北京市昌平区建材城西路金燕龙办公楼一层 邮编：100096 电话：400-618-4000 传真：010-82935100 邮箱: zhanghj+itcast.cn <br>
          京ICP备08001421号京公网安备110108007702
        </p>
      </div>
    </div>
  </div>

  <!-- footer end -->
  <script src="./js/jquery.min.js"></script>
  <script>
    // 操作数据型写法，以操作data数组中数据为主，data数组模拟后台传来的数据
    var data = [{
      msg: '【5本26.8元】经典儿童文学彩图青少版八十天环游地球中学生语文教学大纲',
      img: 'upload/p1.jpg',
      price: 12.60,
      quantity: 4,
      checked: true
    }, {
      msg: '【2000张贴纸】贴纸书 3-6岁 贴画儿童 贴画书全套12册 贴画 贴纸儿童 汽',
      img: 'upload/p2.jpg',
      price: 24.80,
      quantity: 4,
      checked: true
    }, {
      msg: '唐诗三百首+成语故事全2册 一年级课外书 精装注音儿童版 小学生二三年级课外阅读书籍',
      img: 'upload/p3.jpg',
      price: 29.80,
      quantity: 2,
      checked: true
    }]
    /* 需求：
    1.全选框 单选框 联动
    2.商品数量联动小计 联动总数量 --> 在选中时影响总价
    3.全、单选框 勾选或去除操作 --> 小计，总价
    4.删除单个，删除选中，删除全部
    */

    // 检查是否全选的函数
    function checkAll() {
      if (data.length > 0) {
        return data.every(item => item.checked)
      } else {
        return false  // 数组为空，全选框判断出错，坑点
      }
    }

    // 求总价函数
    function getSum() {
      var price = 0
      var quantity = 0
      data.forEach(function (item) {
        if (item.checked) {
          price += item.price * item.quantity
          quantity += item.quantity
        }
      })
      price = price.toFixed(2)
      return {price, quantity}
    }

    // 购物车底栏状态更新函数，包括全选框状态，选中的商品总数状态，总价状态
    function renewFooter() {
      $('.checkall').prop('checked', checkAll())
      $('.price-sum > em').text('￥ ' + getSum().price)
      $('.amount-sum > em').text(getSum().quantity)
    }

    // 初始化函数
    function init() {
      // 初始化购物车的DOM结构
      data.forEach(function (item, index) {
        var dom =
        `<div class="cart-item">
          <div class="p-checkbox">
            <input type="checkbox" class="j-checkbox">
          </div>
          <div class="p-goods">
            <div class="p-img">
              <img src="${item.img}">
            </div>
            <div class="p-msg">${item.msg}</div>
          </div>
          <div class="p-price">￥${item.price}</div>
          <div class="p-num">
            <div class="quantity-form">
              <a href="javascript:;" class="decrement">-</a>
              <input type="text" class="itxt" value="${item.quantity}">
              <a href="javascript:;" class="increment">+</a>
            </div>
          </div>
          <div class="p-sum">￥${(item.price * item.quantity).toFixed(2)}</div>
          <div class="p-action"><a href="javascript:;">删除</a></div>
        </div>`
        $('.cart-item-list').append(dom)
        $('.cart-item').eq(index).find('.j-checkbox').prop('checked', item.checked)
        // 判断是否加变背景色的类名
        if (item.checked) {
          $('.cart-item').eq(index).addClass('check-cart-item')
        }
      })
      // 购物车底栏状态更新
      renewFooter()
    }
    init()

    // 全选框功能，以及与单选框联动
    $('.checkall').click(function () {
      if (checkAll()) { // 原本已经满足全选了，现在点击是要取消全选
        $('.checkall').prop('checked', false)
        data.forEach(item => item.checked = false)
        $('.j-checkbox').prop('checked', false)
        $('.cart-item').removeClass('check-cart-item')
      } else {  // 原本没满足全选，现在点击是要全选
        $('.checkall').prop('checked', true)
        data.forEach(item => item.checked = true)
        $('.j-checkbox').prop('checked', true)
        $('.cart-item').addClass('check-cart-item')
      }
      // 购物车底栏状态更新
      renewFooter()
    })

    // 单选框功能，以及与全选框联动
    $('.j-checkbox').click(function () {
      data[$(this).parents('.cart-item').index()].checked = $(this).prop('checked')
      // 点击单选框后判断添加或去除变背景色的类名
      if ($(this).prop('checked')) {
        $(this).parents('.cart-item').addClass('check-cart-item')
      } else {
        $(this).parents('.cart-item').removeClass('check-cart-item')
      }
      // 购物车底栏状态更新
      renewFooter()
    })

    // 加减器的通用函数
    $('.quantity-form > a').click(function () {
      var index = $(this).parents('.cart-item').index()
      var quantity = Number($(this).siblings('input').val())
      // 判断是加法器还是减法器，类名是increment，则 +1，否则 -1
      var change = $(this).hasClass('increment') ? 1 : -1
      if (quantity + change > 0) {
        quantity += change
      } else {
        var ans = prompt('是否要删除该商品？是1，否2')
        if (ans == 1) {
          alert('下次一定')
        } else if (ans == 2) {
          alert('选择正确')
        }
      }
      $(this).siblings('.itxt').val(quantity)
      data[index].quantity = quantity
      $('.p-sum').eq(index).text('￥' + (quantity * data[index].price).toFixed(2))
      if (data[index].checked) {
        renewFooter()
      }
    // 手动输入完商品数量，input框失焦，更新小计
    }).siblings('.itxt').on('input' ,function () {
      var index = $(this).parents('.cart-item').index()
      data[index].quantity = Number($(this).val())
      console.log($('.p-sum').eq(index))
      $('.p-sum').eq(index).text('￥' + (data[index].quantity * data[index].price).toFixed(2))
      // 购物车底栏状态更新
      renewFooter()
    })

    // 删除单个商品
    $('.p-action > a').click(function () {
      var index = $(this).parents('.cart-item').index()
      // 如果删除的是选中的商品，才需要更新购物车底栏，节约算力
      $(this).parents('.cart-item').remove()
      data.splice(index, 1)
      renewFooter()
    })

    // 清空购物车，删除全部商品
    $('.clear-all').click(function () {
      data.splice(0, data.length)
      $('.cart-item').remove()
      // 购物车底栏状态更新
      renewFooter()
    })

    // 删除选中的商品写法1
    // $('.remove-batch').click(function () {
    //   for (let i = data.length - 1; i >= 0; i--) {
    //     if (data[i].checked) {
    //       $('.cart-item')[i].remove()
    //       data.splice(i, 1)
    //     }
    //   }
    //   renewFooter()
    // })
    // 删除选中的商品写法2
    $('.remove-batch').click(function () {
      data = data.filter(item => !item.checked)
      $('.j-checkbox:checked').parents('.cart-item').remove()
      renewFooter()
    })
  </script>
</body>

</html>